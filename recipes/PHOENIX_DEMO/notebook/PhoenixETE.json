{"paragraphs":[{"text":"%jdbc(phoenix)\n\nDROP TABLE EAGLEAUM101","user":"admin","dateUpdated":"2017-11-20T19:31:06+0000","config":{"editorMode":"ace/mode/sql","colWidth":12,"results":{},"enabled":true,"editorSetting":{"editOnDblClick":false,"language":"sql"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511199056647_942392957","id":"20170925-005745_533219157","dateCreated":"2017-11-20T17:30:56+0000","dateStarted":"2017-11-20T19:31:06+0000","dateFinished":"2017-11-20T19:31:33+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4205"},{"text":"%jdbc(phoenix)\n\nCREATE TABLE IF NOT EXISTS EAGLEAUM101 (\nACCOUNT_NAME VARCHAR(100),\nEFFECTIVE_DATE DATE NOT NULL,\nTENANT_ID INTEGER NOT NULL,\nACCOUNT_CODE VARCHAR(100),\nPOSITION_DETAIL_ID BIGINT,\nACCOUNT_SUBTYPE VARCHAR(100),\nACCOUNT_TYPE VARCHAR(100),\nASSET_CLASS_LEVEL_1 VARCHAR(100),\nASSET_CLASS_LEVEL_2 VARCHAR(100),\nASSET_CLASS_LEVEL_3 VARCHAR(100),\nBASE_CURRENCY VARCHAR(100),\nCLIENT_SUB_TYPE VARCHAR(100),\nCLIENT_TYPE VARCHAR(100),\nCURRENCY_STRATEGY VARCHAR(100),\nINVESTMENT_TYPE VARCHAR(100),\nLEAD_INVESTMENT_MGR VARCHAR(100),\nMANDATE_TYPE VARCHAR(100),\nMARKET_VALUE DOUBLE,\nPORTFOLIO_PM_NAME VARCHAR(100),\nPROCESS_SEC_TYPE VARCHAR(100),\nPRODUCT_CODE VARCHAR(100),\nSECURITY_ALIAS INTEGER NOT NULL,\nSECURITY_CODE VARCHAR(100),\nSECURITY_NAME VARCHAR(100),\nSRC_INTFC_INST INTEGER, \nCONSTRAINT PK_EAGLEAUM10 PRIMARY KEY (ACCOUNT_NAME, EFFECTIVE_DATE, TENANT_ID, SECURITY_ALIAS)) \nSALT_BUCKETS = 40,\nDISABLE_WAL=true;","user":"admin","dateUpdated":"2017-11-20T19:31:58+0000","config":{"editorMode":"ace/mode/sql","colWidth":12,"results":{},"enabled":true,"editorSetting":{"editOnDblClick":false,"language":"sql"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511199056652_938930217","id":"20170922-224118_171789405","dateCreated":"2017-11-20T17:30:56+0000","dateStarted":"2017-11-20T19:31:58+0000","dateFinished":"2017-11-20T19:32:00+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:4206"},{"text":"%spark.dep\n\nz.load(\"com.databricks:spark-csv_2.10:1.5.0\")\nz.load(\"/usr/hdp/current/phoenix-client/phoenix-client.jar\")","user":"admin","dateUpdated":"2017-11-20T18:43:24+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"results":{},"enabled":true,"editorSetting":{"editOnDblClick":false,"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511199056653_938545468","id":"20170924-045740_1699620605","dateCreated":"2017-11-20T17:30:56+0000","dateStarted":"2017-11-20T18:43:24+0000","dateFinished":"2017-11-20T18:43:30+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:4207"},{"text":"%spark\n\nvar df = sqlContext.read.format(\"com.databricks.spark.csv\").option(\"header\", \"false\").option(\"inferSchema\", \"false\").load(\"/tmp/aum.csv\")\nval newNames = Seq(\"ACCOUNT_NAME\",\"EFFECTIVE_DATE\",\"TENANT_ID\",\"ACCOUNT_CODE\",\"POSITION_DETAIL_ID\",\"ACCOUNT_SUBTYPE\",\"ACCOUNT_TYPE\",\"ASSET_CLASS_LEVEL_1\",\"ASSET_CLASS_LEVEL_2\",\"ASSET_CLASS_LEVEL_3\",\"BASE_CURRENCY\",\"CLIENT_SUB_TYPE\",\"CLIENT_TYPE\",\"CURRENCY_STRATEGY\",\"INVESTMENT_TYPE\",\"LEAD_INVESTMENT_MGR\",\"MANDATE_TYPE\",\"MARKET_VALUE\",\"PORTFOLIO_PM_NAME\",\"PROCESS_SEC_TYPE\",\"PRODUCT_CODE\",\"SECURITY_ALIAS\",\"SECURITY_CODE\",\"SECURITY_NAME\",\"SRC_INTFC_INST\")\ndf = df.toDF(newNames: _*)\ndf.printSchema\n//df.withColumn(\"EFFECTIVE_DATE\", date_format(df2(\"start_datetime_inclusive\"),\"yyyy-MM-dd HH:mm:ss\").cast(\"timestamp\"))\ndf = df.withColumn(\"TENANT_ID\", df(\"TENANT_ID\").cast(\"Integer\"))\ndf = df.withColumn(\"POSITION_DETAIL_ID\", df(\"POSITION_DETAIL_ID\").cast(\"Long\"))\ndf = df.withColumn(\"MARKET_VALUE\", df(\"MARKET_VALUE\").cast(\"Double\"))\ndf = df.withColumn(\"SECURITY_ALIAS\", df(\"SECURITY_ALIAS\").cast(\"Integer\"))\ndf = df.withColumn(\"SRC_INTFC_INST\", df(\"SRC_INTFC_INST\").cast(\"Integer\"))\ndf.printSchema\ndf.show\ndf.cache","user":"admin","dateUpdated":"2017-11-20T21:05:41+0000","config":{"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","colWidth":12,"editorHide":false,"results":{},"enabled":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511199056654_939699715","id":"20170922-224146_816469800","dateCreated":"2017-11-20T17:30:56+0000","dateStarted":"2017-11-20T18:45:49+0000","dateFinished":"2017-11-20T18:46:27+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:4208"},{"text":"%spark\n\nimport java.net.InetAddress\nimport org.apache.phoenix.spark._\nimport org.apache.spark.sql.SaveMode\n\nval zkConnectString = InetAddress.getLocalHost().getHostName()+\":2181:/hbase-unsecure\"\ndf.write.format(\"org.apache.phoenix.spark\").mode(SaveMode.Overwrite).options(Map(\"table\" -> \"EAGLEAUM101\",\"zkUrl\" -> zkConnectString)).save","user":"admin","dateUpdated":"2017-11-20T19:32:17+0000","config":{"tableHide":false,"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","colWidth":12,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511199056655_939314966","id":"20170922-230147_1131686471","dateCreated":"2017-11-20T17:30:56+0000","dateStarted":"2017-11-20T19:32:17+0000","dateFinished":"2017-11-20T19:39:42+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:4209"},{"text":"%sh\n\necho \"THIS STEP COMPACTS THE TABLE THAT WAS JUST WRITTEN TO BY THE SPARK PHOENIX ADAPTER.\"\necho \"DO NOT PROCEED TO THE NEXT STEP UNTILL MAJOR COMPACTION IS COMPLETE AS READ PERFORAMNCE WILL BE IMPACTED.\"\necho \"CHECK HBASE MASTER UI FOR COMPACTION PROGRESS.\"\necho \"major_compact 'EAGLEAUM101'\" | hbase shell","user":"admin","dateUpdated":"2017-11-20T21:00:19+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511210136972_626385683","id":"20171120-203536_1268624319","dateCreated":"2017-11-20T20:35:36+0000","dateStarted":"2017-11-20T21:00:09+0000","dateFinished":"2017-11-20T21:00:15+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:4210"},{"text":"%jdbc(phoenix)\n\nSELECT *\nFROM eagleaum101 \n","user":"admin","dateUpdated":"2017-11-20T20:03:18+0000","config":{"editorMode":"ace/mode/sql","colWidth":12,"results":{},"enabled":true,"editorSetting":{"editOnDblClick":false,"language":"sql"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511199056655_939314966","id":"20170927-135342_1907962500","dateCreated":"2017-11-20T17:30:56+0000","dateStarted":"2017-11-20T20:03:18+0000","dateFinished":"2017-11-20T20:03:19+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:4211"},{"text":"%jdbc(phoenix)\n\nSELECT count(account_name) \nFROM eagleaum101 \n\n","user":"admin","dateUpdated":"2017-11-20T21:17:32+0000","config":{"editorMode":"ace/mode/sql","colWidth":12,"results":{"0":{"graph":{"height":94,"optionOpen":false,"mode":"table"}}},"enabled":true,"editorSetting":{"editOnDblClick":false,"language":"sql"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511199056656_949703186","id":"20170927-134116_1604823232","dateCreated":"2017-11-20T17:30:56+0000","dateStarted":"2017-11-20T21:17:32+0000","dateFinished":"2017-11-20T21:17:42+0000","status":"ERROR","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:4212"},{"text":"%jdbc(phoenix)\n\nselect * \nfrom eagleaum101 \nwhere effective_date = TO_DATE('2016-03-03 00:00:00.000')\nand tenant_id in (50)\nand security_alias = 2\n--and account_name = 'Account_10034600'","user":"admin","dateUpdated":"2017-11-20T20:52:03+0000","config":{"editorMode":"ace/mode/sql","colWidth":12,"results":{"0":{"graph":{"height":84,"optionOpen":false,"mode":"table"}}},"enabled":true,"editorSetting":{"editOnDblClick":false,"language":"sql"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511199056657_949318437","id":"20170924-064501_586535007","dateCreated":"2017-11-20T17:30:56+0000","dateStarted":"2017-11-20T20:51:52+0000","dateFinished":"2017-11-20T20:51:55+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:4213"},{"text":"%jdbc(phoenix)\n\nSELECT count(account_name), effective_date\n--SELECT /*+SKIP_SCAN*/ count(account_name), effective_date\nFROM eagleaum101 \nWHERE effective_date between TO_DATE('2016-03-03 00:00:00.000') and TO_DATE('2017-12-30 00:00:00.000')\nAND tenant_id in (50)\nAND security_alias = 2\nGROUP BY effective_date","user":"admin","dateUpdated":"2017-11-20T20:53:41+0000","config":{"tableHide":false,"editorSetting":{"editOnDblClick":false,"language":"sql"},"editorMode":"ace/mode/sql","colWidth":12,"results":{"0":{"graph":{"keys":[{"index":1,"name":"EFFECTIVE_DATE","aggr":"sum"}],"optionOpen":false,"height":300,"setting":{"pieChart":{}},"values":[{"index":0,"name":"COUNT(ACCOUNT_NAME)","aggr":"sum"}],"mode":"pieChart","groups":[{"index":1,"name":"EFFECTIVE_DATE","aggr":"sum"}],"commonSetting":{}},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511199056657_949318437","id":"20170923-001525_376428876","dateCreated":"2017-11-20T17:30:56+0000","dateStarted":"2017-11-20T20:53:01+0000","dateFinished":"2017-11-20T20:53:12+0000","status":"ERROR","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:4214"},{"text":"%jdbc(phoenix)\n\nSELECT ACCOUNT_CODE, ACCOUNT_NAME AS label,\nSUM(CASE WHEN (ASSET_CLASS_LEVEL_2 = 'Option' OR ASSET_CLASS_LEVEL_2 = 'Option2') AND (ASSET_CLASS_LEVEL_3 = 'Security' OR ASSET_CLASS_LEVEL_3 = 'Security2' OR ASSET_CLASS_LEVEL_3 = 'Security3') THEN (MARKET_VALUE / 300) ELSE 0 END) AS AUM,\nSUM(MARKET_VALUE)\nFROM eagleaum101\nWHERE EFFECTIVE_DATE = TO_DATE('2016-03-03 00:00:00.000')  AND ACCOUNT_NAME IN ('Account_10034600', 'Account_65960495', 'Account_10000027', 'Account_17021644', 'Account_3798389') \nGROUP BY ACCOUNT_CODE, ACCOUNT_NAME\nORDER BY AUM ASC","user":"admin","dateUpdated":"2017-11-20T20:56:28+0000","config":{"editorMode":"ace/mode/sql","colWidth":12,"results":{"0":{"graph":{"keys":[{"index":0,"name":"ACCOUNT_CODE","aggr":"sum"}],"optionOpen":false,"height":300,"setting":{"pieChart":{}},"values":[{"index":3,"name":"SUM(MARKET_VALUE)","aggr":"sum"},{"index":2,"name":"AUM","aggr":"sum"}],"mode":"pieChart","groups":[{"index":0,"name":"ACCOUNT_CODE","aggr":"sum"},{"index":1,"name":"LABEL","aggr":"sum"}],"commonSetting":{}},"helium":{}}},"enabled":true,"editorSetting":{"editOnDblClick":false,"language":"sql"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511199056658_950472684","id":"20170924-062615_225136849","dateCreated":"2017-11-20T17:30:56+0000","dateStarted":"2017-11-20T20:56:28+0000","dateFinished":"2017-11-20T20:56:28+0000","status":"ERROR","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:4215"},{"dateUpdated":"2017-11-20T17:30:56+0000","config":{"editorMode":"ace/mode/scala","colWidth":12,"results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1511199056658_950472684","id":"20170926-211830_1797791469","dateCreated":"2017-11-20T17:30:56+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:4216"}],"name":"PhoenixETE","id":"2D189NRR5","angularObjects":{"2CHS8UYQQ:shared_process":[],"2CK8A9MEG:shared_process":[],"2CKX8WPU1:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}
